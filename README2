# Wazuh + Sysmon Detection Lab — Max

## Overview
Simple Wazuh lab (Ubuntu manager + Windows endpoint with Sysmon) used to author and test custom detection rules.

## Rules implemented
### 210130 — schtasks scheduled-task creation
- **Description:** Detects scheduled task creation via `schtasks.exe /Create`.  
- **Technique:** MITRE T1053.005 (Scheduled Task).  
- **Test:** `schtasks /Create /SC ONCE /TN LabTask /TR "cmd.exe /c echo hi > %TEMP%\lab.txt" /ST 23:59`  
- **Evidence:** `screenshots/210130_doc.png`, `screenshots/210130_event.png`

### 210131 — PowerShell encoded execution
- **Description:** Detects PowerShell using encoded command flag `-enc` to reduce noise from normal PowerShell use.  
- **Technique:** MITRE T1059.001 (PowerShell).  
- **Test:** `powershell.exe -enc <base64 payload>`  
- **Evidence:** `screenshots/210131_doc.png`, `screenshots/210131_event.png`

## Architecture
- Wazuh manager: Ubuntu VM 192.168.56.105  
- Windows agent: Sysmon with SwiftOnSecurity config  
- Communication: agent enrollment on ports 1514/1515

## Notes
- Rule tuning: used `if_group sysmon_event1` to scope to Sysmon process-create events.  
- XML/CDATA care: created rules via server file `/var/ossec/etc/rules/local_rules.xml` to avoid web UI corruption.

## How to reproduce
1. Deploy Wazuh manager (v4.14) on Ubuntu.  
2. Install Sysmon + SwiftOnSecurity on Windows endpoint.  
3. Add `local_rules.xml` rules and restart wazuh-manager.  
